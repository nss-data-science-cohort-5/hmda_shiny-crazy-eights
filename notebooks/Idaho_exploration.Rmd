
		-- IDAHO EXPLORATION -- ROSS K.


# https://github.com/nss-data-science-cohort-5/hmda_shiny-crazy-eights/blob/ross-branch/notebooks/Idaho_exploration.Rmd


```{r}
library(shiny)
library(tidyverse)
```

```{r}
idaho_2020 <- read.csv('../data/state_ID.csv')
```


```{r}
field_defs <- read_csv('../data/field_definitions.csv')
field_defs <- field_defs %>%
  filter(!is.na(description))
```



# PART 1a - MINIMUM VIABLE PRODUCT - DEMOGRAPHICS


```{r}
# PERCENTAGES OF LOANS APPLIED FOR BY AGE
idaho_age_counts <- idaho_2020 %>%
  count(applicant_age) %>%
  mutate(age_pct = (n * 100) / sum(n))

idaho_age_counts
```


```{r}
# PERCENTAGES OF APPLICANTS OVER 62
idaho_over_62 <- idaho_2020 %>%
  count(applicant_age_above_62) %>%
  mutate(over_62_pct = (n * 100) / sum(n))

idaho_over_62
```


```{r}
# PERCENTAGES OF LOANS APPLIED FOR BY SEX
idaho_sex_counts <- idaho_2020 %>%
  count(applicant_sex) %>%
  mutate(sex_pct = (n * 100) / sum(n))

idaho_sex_counts
```

```{r}
# PERCENTAGES OF LOANS APPLIED FOR BY RACE--	
#		 MIGHT BE FASTER TO USE applicant_race.1 AND JUST TRANSLATE IN ui.R?

idaho_race_counts <- idaho_2020 %>%
  count(derived_race) %>%
  mutate(race_pct = (n * 100) / sum(n))

idaho_race_counts
```




# PART 1b - MINIMUM VIABLE PRODUCT - LEI & MSAs

```{r}
# TO DO - Select a lending institution by its LEI, and be able to select 
# a subset of peer institutions based on geographical area (County, State, MSA/Census Tract)

# Might just return a table full of text data for Minimum Viable Product.
# Bonus - could try using sf to show geographical area (County, State, or MSA/Census Tract) --
#		CAN FIND sf CHEAT SHEET AT https://github.com/rstudio/cheatsheets/blob/main/sf.pdf
#		OR https://ugoproto.github.io/ugo_r_doc/pdf/sf.pdf
```


```{r}
# PERCENTAGES OF DIFFERENT LEIs
idaho_lei_counts <- idaho_2020 %>%
  count(lei) %>%
  mutate(lei_pct = (n * 100) / sum(n))

idaho_lei_counts
```

```{r}
# TOTAL LOAN VOLUMES AMONG LENDERS
idaho_2020 %>%
  group_by(lei) %>%
  summarise(total_loan_volume = sum(loan_amount)) %>%
  arrange(desc(total_loan_volume)) %>%
  ungroup()
```


```{r}
# BONUS / TO DO - LOANS APPROVED OR DENIED BY LENDER - action_taken COLUMN -- 
# 			USE pivot_longer OR pivot_wider?

```	
	
```{r}
# BONUS / TO DO - LOAN DENIAL REASONS

```	



# PART 2 - OPTIONAL BONUS

# PREDATORY LENDING? - DEMOGRAPHICS OF CREDIT SCORES, RATE SPREAD, DTI, LTV (ACROSS MSAs)


# BONUS / TO DO - CREDIT SCORES ABOVE OR BELOW CUTOFFS, e.g. 700 --
# 		WOULD THIS BE MORE USEFUL AS A PIVOTED OR ROWWISE FUNCTION

# 2021 CREDIT SCORE RANGES --
#		FICO 300-579 = POOR; 580-669 = FAIR; 670-739 = GOOD; 740-799 = VERY GOOD; 800-850 = EXCELLENT
# FROM smartasset.com/credit-cards/what-are-the-credit-score-ranges


```{r}
# CREDIT SCORE TYPE BY AGE
idaho_2020 %>%
  group_by(applicant_age) %>%
  # view()
  summarize(med_age_cred = median(applicant_credit_score_type,
                                   na.rm = TRUE)) %>%
  ungroup()
```

```{r}
# CREDIT SCORE TYPE OVER 62
idaho_2020 %>%
  group_by(applicant_age_above_62) %>%
  # view()
  summarize(med_over_62_cred = median(applicant_credit_score_type,
									  na.rm = TRUE)) %>%
  ungroup()
```

```{r}
# CREDIT SCORE TYPE BY ETHNICITY
idaho_2020 %>%
  group_by(derived_ethnicity) %>%
  # view()
  summarize(med_ethn_cred = median(applicant_credit_score_type,
                                   na.rm = TRUE)) %>%
  ungroup()
```

```{r}
# CREDIT SCORE TYPE BY RACE
idaho_2020 %>%
  group_by(derived_race) %>%
  # view()
  summarize(med_race_cred = median(applicant_credit_score_type,
                                   na.rm = TRUE)) %>%
  ungroup()
```

```{r}
# CREDIT SCORE TYPE BY SEX
idaho_2020 %>%
  group_by(applicant_sex) %>%
  # view()
  summarize(med_sex_cred = median(applicant_credit_score_type,
                                  na.rm = TRUE)) %>%
  ungroup()
```



```{r}
# RATE SPREAD BY AGE
idaho_2020 %>%
  filter(rate_spread != 'Exempt') %>%
  group_by(applicant_age) %>%
  summarize(med_age_rate_sprd = median(as.double(rate_spread,
                                       na.rm = TRUE))) %>%
  arrange(desc(med_age_rate_sprd)) %>%
  ungroup()
```

```{r}
# RATE SPREAD OVER 62
idaho_2020 %>%
  filter(rate_spread != 'Exempt') %>%
  group_by(applicant_age_above_62) %>%
  summarize(med_over_62_rate_sprd = median(as.double(rate_spread,
                                           na.rm = TRUE))) %>%
  arrange(desc(med_over_62_rate_sprd)) %>%
  ungroup()
```

```{r}
# RATE SPREAD BY ETHNICITY
idaho_2020 %>%
  filter(rate_spread != 'Exempt') %>%
  group_by(derived_ethnicity) %>%
  summarize(med_ethn_rate_sprd = median(as.double(rate_spread,
                                        na.rm = TRUE))) %>%
  arrange(desc(med_ethn_rate_sprd)) %>%
  ungroup()
```

```{r}
# RATE SPREAD BY RACE
idaho_2020 %>%
  filter(rate_spread != 'Exempt') %>%
  group_by(derived_race) %>%
  summarize(med_race_rate_sprd = median(as.double(rate_spread,
                                        na.rm = TRUE))) %>%
  arrange(desc(med_race_rate_sprd)) %>%
  ungroup()
```

```{r}
# RATE SPREAD BY SEX
idaho_2020 %>%
  filter(rate_spread != 'Exempt') %>%
  group_by(applicant_sex) %>%
  summarize(med_sex_rate_sprd = median(as.double(rate_spread,
                                       na.rm = TRUE))) %>%
  arrange(desc(med_sex_rate_sprd)) %>%
  ungroup()
```




```{r}
# ARE INTEREST RATES DIFFERENT ON SAME LTVs FOR DIFFERENT RACES?  
# ORIGINATION FEES, DISCOUNT POINTS, NEGATIVE AMORTIZATION, INTEREST-ONLY PAYMENTS,
# BALLOON PAYMENTS, ...
```


